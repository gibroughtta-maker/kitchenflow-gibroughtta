# Intelligent Voice Agent 测试指南

这份指南基于第一性原理设计，旨在验证语音代理的核心功能、边界条件和系统鲁棒性。

## 🛠️ 准备工作 (Prerequisites)

1.  **物理设备**: 由于涉及麦克风，强烈建议在真机 (iOS/Android) 上测试，模拟器可能无法正确录音。
2.  **API Key**: 确保 `src/services/scannerService.ts` 中的 `globalConfig` 已配置有效的 Gemini API Key。
3.  **网络环境**: 确保设备连接到可以访问 Google Gemini API 的网络。
4.  **音量**: 调大设备音量以听到 TTS 反馈。

---

## 🧪 测试用例清单

### 第 1 阶段: 基础功能验证 (Happy Path)
*验证核心价值：音频是否能转化为购物清单项*

#### 用例 1.1: 麦克风权限流程
- **操作**: 首次点击红色的麦克风按钮。
- **预期**: 系统弹出“请求麦克风权限”对话框。
- **操作**: 点击“允许”。
- **预期**: 权限获批，无错误提示。

#### 用例 1.2: 简单商品添加
- **操作**: 按住按钮，清晰地说：“买一盒牛奶”。(Buy a carton of milk)
- **释放**: 松开按钮。
- **预期**:
    1.  松开时有震动反馈。
    2.  按钮显示转圈加载动画。
    3.  约 1-3 秒后，购物清单出现 "Milk" (或 "牛奶")。
    4.  TTS 语音播报: "Added 1 item" 或 "Added Milk"。

---

### 第 2 阶段: 智能解析验证 (Advanced Intelligence)
*验证 AI 价值：理解意图与上下文*

#### 用例 2.1: 菜谱扩展 (Recipe Expansion)
- **操作**: 按住按钮，说：“我想做麻婆豆腐”。(I want to cook Mapo Tofu)
- **预期**:
    1.  列表自动添加多个相关食材：Tofu (豆腐), Minced Meat (肉末), Chili Paste (豆瓣酱/辣椒酱) 等。
    2.  TTS 语音播报: "Added 3 ingredients" (数量可能不同)。

#### 用例 2.2: 包含数量单位
- **操作**: 按住按钮，说：“买 5 个苹果和 2 公斤大米”。
- **预期**:
    1.  列表添加 "Apple" (Qty: 5, Unit: pcs/个)。
    2.  列表添加 "Rice" (Qty: 2, Unit: kg)。

---

### 第 3 阶段: 生产级优化验证 (Edge Cases & Robustness)
*验证系统稳定性：在非理想情况下的表现*

#### 用例 3.1: 防误触 (Short Recording)
- **操作**: 快速点击按钮（按住时间小于 0.5 秒）。
- **预期**:
    1.  **不**发起网络请求。
    2.  弹出提示框：“录音太短，请长按按钮并清晰说话”。

#### 用例 3.2: 无效音频 (Invalid Audio)
- **操作**: 按住按钮 2 秒，但完全不说话（保持静音）。
- **预期**:
    1.  Gemini 分析后发现无内容。
    2.  TTS 语音播报: "Sorry, I didn't catch that."。

#### 用例 3.3: 网络超时 (Network Timeout)
- **操作**: (如果方便) 断开手机网络或使用弱网工具。按住按钮说话并松开。
- **预期**:
    1.  加载动画持续 10 秒（设定的超时时间）。
    2.  弹出提示框：“网络超时，请检查网络连接后重试”。
    3.  加载状态结束，恢复正常界面。

---

## 🔧 故障排查 (Troubleshooting)

| 现象 | 可能原因 | 解决方案 |
|------|---------|----------|
| **点击按钮无反应** | 权限被拒绝 | 去系统设置中开启 App 的麦克风权限。 |
| **一直显示加载圈** | 网络不通或 API 阻塞 | 检查网络；确认 API Key 是否欠费或被限流。 |
| **提示 "API Error"** | API Key 无效 | 检查代码中是否配置了正确的 `apiKey`。 |
| **识别不准** | 环境嘈杂 | 请在相对安静的环境下测试；尝试大声一点。 |
| **无语音反馈** | 设备静音 | 检查手机媒体音量是否由于静音模式被关闭。 |

---

> **注意**: 测试完成后，如果发现 Gemini 响应速度过慢，可以考虑在 `scannerService.ts` 中暂时切换回 `gemini-1.5-flash` 模型进行对比测试。
