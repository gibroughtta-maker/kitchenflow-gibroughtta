---
description: 当实现完成、所有测试通过、需要决定如何集成工作时使用 - 指导完成开发工作，呈现合并/PR/清理的结构化选项
---

# 完成开发分支

## 第一性原理

**为什么要有仪式感？** 代码的生命周期不止于"写完"。合并、发布、清理是完整闭环的一部分。

**核心公理：**
1. 验证先于声明 - 只有测试通过了才能说"完成"
2. 明确的选项减少决策疲劳
3. 清理是专业精神的体现 - 不留垃圾分支

## 流程

### 步骤 1：验证测试
**呈现选项前，必须验证测试通过：**

```bash
npm test / cargo test / pytest / go test ./...
```

**如果测试失败：**
```
测试失败（N 个失败）。必须修复后才能继续：
[显示失败]
在测试通过之前无法进行合并/PR。
```
停止。不要进入步骤 2。

### 步骤 2：确定基础分支
```bash
git merge-base HEAD main 2>/dev/null || git merge-base HEAD master
```

### 步骤 3：呈现选项
呈现这 4 个选项：

```
实现完成。你想怎么做？

1. 本地合并回 <基础分支>
2. 推送并创建 Pull Request
3. 保持分支现状（稍后处理）
4. 丢弃这项工作

选哪个？
```

### 步骤 4：执行选择

#### 选项 1：本地合并
```bash
git checkout <基础分支>
git pull
git merge <功能分支>
<测试命令>
git branch -d <功能分支>
```

#### 选项 2：推送并创建 PR
```bash
git push -u origin <功能分支>
gh pr create --title "<标题>" --body "..."
```

#### 选项 3：保持现状
报告："保持分支 <名称>。工作树保留在 <路径>。"

#### 选项 4：丢弃
**必须先确认：**
```
这将永久删除：
- 分支 <名称>
- 所有提交
- 工作树

输入 'discard' 确认。
```

## 快速参考

| 选项 | 合并 | 推送 | 保留工作树 | 清理分支 |
|------|------|------|------------|----------|
| 1. 本地合并 | ✓ | - | - | ✓ |
| 2. 创建 PR | - | ✓ | ✓ | - |
| 3. 保持现状 | - | - | ✓ | - |
| 4. 丢弃 | - | - | - | ✓ (强制) |
