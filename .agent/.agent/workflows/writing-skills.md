---
description: 创建新 workflow、编辑现有 workflow 或验证 workflow 在部署前有效时使用
---

# 编写 Workflow

## 第一性原理

**为什么用 TDD 写文档？** 文档是给别人（包括未来的 AI）看的。不测试就写文档 = 假设读者能理解。

**核心公理：**
1. 文档是可执行规格 - 如果 AI 不能按文档做对，文档有问题
2. 看到失败才知道文档真的在教东西
3. 闭合每个漏洞 - AI 会找借口，文档要堵住

## 什么是 Workflow？

**Workflow** 是经过验证的技术、模式或工具的参考指南。帮助未来的 AI 找到并应用有效方法。

**Workflow 是：** 可复用技术、模式、工具、参考指南
**Workflow 不是：** 关于你如何解决一次问题的叙事

## 何时创建

**创建条件：**
- 技术对你来说不是显而易见的
- 你会跨项目再次引用这个
- 模式广泛适用（非项目特定）

**不要创建：**
- 一次性解决方案
- 其他地方有良好文档的标准实践
- 项目特定约定

## 目录结构

```
.agent/workflows/
  workflow-name.md    # 主参考文件
```

## YAML 前置内容

```yaml
---
description: 使用条件 [具体触发条件和症状]
---
```

**关键规则：**
- 以"Use when..."或中文"当...时使用"开头
- 只描述何时使用，不描述做什么
- 包含具体症状、情况、上下文

## Workflow 结构

```markdown
# Workflow 名称

## 第一性原理
为什么需要这个？核心公理是什么？

## 概述
这是什么？核心原则 1-2 句话。

## 何时使用
症状和用例的要点列表
何时不使用

## 流程/步骤
具体步骤，代码示例

## 常见错误
什么会出错 + 修复

## 危险信号
何时停止并重新考虑
```

## 铁律（与 TDD 相同）

```
没有失败测试，不要写 Workflow
```

这适用于新 workflow 和对现有 workflow 的编辑。

先写了 workflow 没测试？删掉它。重新开始。

## 测试 Workflow

### 纪律执行型（规则/要求）
**测试方式：**
- 压力场景：压力下它们遵守吗？
- 识别借口并添加明确反驳

### 技术型（操作指南）
**测试方式：**
- 应用场景：能正确应用技术吗？
- 缺失信息：指令有漏洞吗？

## 防御借口

**闭合每个漏洞：**
```markdown
先写代码再写测试？删掉它。重新开始。

**没有例外：**
- 不要保留作为"参考"
- 不要在写测试时"调整"它
- 删除就是删除
```

**构建借口表：**
```markdown
| 借口 | 现实 |
|------|------|
| "太简单不用测" | 简单代码也会坏。测试只需 30 秒。 |
| "之后再测" | 立即通过的测试什么都不证明。 |
```

**创建危险信号列表：**
```markdown
## 危险信号 - 停下来重新开始

- 代码写在测试之前
- "之后"再加测试
- 在说服自己"就这一次"

**这些都意味着：删除代码。用 TDD 重新开始。**
```
