---
description: 当面对 2 个或更多独立任务，它们之间没有共享状态或顺序依赖时使用
---

# 并行派发代理

## 第一性原理

**为什么要并行？** 时间是不可再生资源。独立任务串行处理是对时间的浪费。

**核心公理：**
1. 独立性是并行的前提 - 没有依赖才能同时进行
2. 分治思想 - 大问题拆成小问题，各个击破
3. 并行 ≠ 乱来 - 必须保证每个子任务边界清晰

## 何时使用

**适用场景：**
- 3+ 个测试文件失败，原因各不相同
- 多个子系统独立出问题
- 每个问题可以独立理解，不需要其他问题的上下文

**不适用场景：**
- 问题之间有关联（修一个可能连带修好其他的）
- 需要理解完整系统状态
- 代理之间会互相干扰（改同一个文件）

## 执行模式

### 1. 识别独立域
按"坏了什么"分组：
- A 文件测试：工具审批流程
- B 文件测试：批处理完成行为
- C 文件测试：中止功能

### 2. 创建聚焦任务
每个代理获得：
- **明确范围**：一个测试文件或子系统
- **清晰目标**：让这些测试通过
- **约束条件**：不要改其他代码
- **预期输出**：发现和修复的摘要

### 3. 并行派发
```
代理1 → 修复 agent-tool-abort.test.ts
代理2 → 修复 batch-completion-behavior.test.ts
代理3 → 修复 tool-approval-race-conditions.test.ts
```

### 4. 审查和集成
- 读取每个代理的摘要
- 验证修复不冲突
- 运行完整测试套件
- 整合所有更改

## 常见错误

- ❌ 范围太广："修复所有测试" → 代理会迷失
- ✅ 范围具体："修复 agent-tool-abort.test.ts"

- ❌ 没有约束：代理可能重构一切
- ✅ 有约束："不要改生产代码"
